<div class="app-shell">
  <ng-container *ngIf="showShell()">
    <header class="topbar">
      <div class="brand">
        <span class="brand-mark"></span>
        <div>
          <p class="brand-name">BudgetFlow</p>
          <p class="brand-sub">Plan · Track · Grow</p>
        </div>
      </div>

      <nav class="main-nav">
        <a
          *ngFor="let item of navItems"
          [routerLink]="item.path"
          routerLinkActive="active"
          [routerLinkActiveOptions]="{ exact: true }"
        >
          {{ item.label }}
        </a>
      </nav>

      <div class="theme-toggle">
        <label class="switch">
          <input type="checkbox" [checked]="theme() === 'light'" (change)="toggleTheme($event.target.checked)">
          <span class="slider"></span>
        </label>
        <span class="theme-label">{{ theme() === 'light' ? 'Light' : 'Dark' }}</span>
      </div>

      <div class="user-chip">
        <div class="avatar">{{ (userName() || 'G').slice(0,2).toUpperCase() }}</div>
        <div>
          <p class="user-name">{{ userName() }}</p>
          <p class="user-plan" *ngIf="isLoggedIn(); else guest">Personal plan</p>
          <ng-template #guest><span class="user-plan">Guest</span></ng-template>
        </div>
        <div class="auth-actions">
          <button class="btn ghost" *ngIf="!isLoggedIn()" (click)="login()">Sign in</button>
          <button class="btn primary" *ngIf="!isLoggedIn()" (click)="gotoRegister()">Create account</button>
          <button class="btn ghost" *ngIf="isLoggedIn()" (click)="logout()">Sign out</button>
        </div>
      </div>
    </header>

    <section class="hero" *ngIf="heroKpis$ | async as hero">
      <div>
        <p class="eyebrow">Budget dashboard</p>
        <h1>
          Keep your spending under control
          <span class="accent">with clarity.</span>
        </h1>
        <p class="lede">
          Build budgets, add transactions, and watch your cashflow stay on track with instant feedback.
        </p>
        <div class="cta-row">
          <a class="cta primary" routerLink="/budgets">Create budget</a>
          <a class="cta ghost" routerLink="/transactions">Log transaction</a>
        </div>
      </div>

      <div class="hero-card">
        <div class="stat">
          <p class="label">Active budgets</p>
          <p class="value">{{ hero.activeBudgets }}</p>
        </div>
        <div class="stat">
          <p class="label">This month</p>
          <p class="value positive">{{ hero.income | currency }}</p>
        </div>
        <div class="stat">
          <p class="label">Spent</p>
          <p class="value negative">-{{ hero.expenses | currency }}</p>
        </div>
      </div>
    </section>
  </ng-container>

  <main class="page-shell">
    <router-outlet></router-outlet>
  </main>
</div>
